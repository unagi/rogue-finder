# Rogue Finder ユーザーマニュアル (日本語)

## 目的と読者
Rogue Finder はローカルにインストール済みの Nmap を用いて軽量なディスカバリースキャンを実行し、スコアリング結果をもとに優先度の高いホストを素早く特定するためのクロスプラットフォーム GUI ユーティリティです。本書は PyInstaller 版を利用するユーザー向けに、導入方法・操作手順・トラブルシューティングをまとめています。

## できること
- Nmap の ICMP (-sn -PE)、TCP SYN (-sS) ポート走査、OS フィンガープリント (-O -Pn) を GUI から連続実行。
- IP / CIDR / ホスト名を複数入力し、GUI がフリーズしない形で並列スキャンを実現。
- `nmap_gui_system_spec.md` に準拠したスコアリングで High / Medium / Low を色分け表示。
- 結果を UTF-8 CSV / JSON に書き出し、スコアの内訳やエラーログも同梱。

## 前提条件と準備
1. PyInstaller 版バイナリは単体で動作しますが、Nmap は別途インストールが必要です。
2. Nmap を OS ごとにセットアップし、`nmap --version` が成功することを確認してください。
   - **Windows:** <https://nmap.org/download.html> からインストーラーを入手 → デフォルト設定で導入 → 新しいコマンドプロンプトで `nmap --version`。
   - **macOS (Apple Silicon 専用):** リリース版は arm64 (Apple Silicon) 用にビルドされています。Intel Mac では `python -m nmap_gui.main` でソースから実行するか、必要に応じて Rosetta を利用してください。`brew install nmap` または公式 dmg で Nmap を導入します。
   - **Linux:** ディストリビューションのパッケージマネージャー (例: `sudo apt install nmap`)。
3. Rogue Finder の実行ファイルと本マニュアル (英語版/日本語版) を同じフォルダーに置いておくと参照しやすくなります。

## 使い方
1. **起動** — `rogue-finder.exe` (Windows) もしくは `./rogue-finder` (macOS/Linux) を実行します。
2. **ターゲット入力** — 1 行ごとまたはカンマ/タブ/セミコロン区切りで IP、CIDR、ホスト名を貼り付けます。
3. **スキャンモード選択** — ICMP / Ports / OS のチェックボックスで使用フェーズを切り替えます (標準ではすべて有効)。
4. **開始/停止** — **開始** ボタンでスキャンを実行、進捗バーに完了数が表示されます。途中で止めたい場合は **停止** をクリックしてください。
5. **結果確認** — テーブルで Alive、開放ポート、OS 推定、スコア、優先度、エラー＋推奨対応を確認できます。列ヘッダーをクリックすると並び替え可能です。
6. **エクスポート** — **CSV出力 / JSON出力** ボタンでレポートを保存します。JSON には構造化された `errors` と読みやすい `errors_text` の両方が含まれます。

### 利用上の注意
- スキャン対象は許可を得た範囲に限定してください。Rogue Finder は軽量な設定ですが、ネットワーク運用ポリシーに従う必要があります。
- エクスポート先ディレクトリに書き込み権限があることを確認してください。
- 大規模な CIDR をまとめて指定すると Nmap 側のタイムアウトが発生する可能性があります。必要に応じて分割してください。

## 設定ファイル
アプリは起動時にカレントディレクトリ（PyInstaller バイナリと同じ場所）に `rogue-finder.config.yaml` が存在するか確認し、未作成なら既定値で自動生成します。将来バージョンアップで項目が増えた場合も不足キーだけが追記され、利用者が上書きした値や独自キーは保持されます。この YAML で以下を調整できます:

- `scan`: フェーズごとのタイムアウト、スキャン対象ポートリスト、高番ポートの閾値
- `rating`: ICMP/ポート/OS の加点、コンボボーナス、優先度境界
- `ui`: 優先度別の行カラー（16 進色コード）
- `safe_scan`: Safe Script ダイアログの進捗バーしきい値

環境ごとのデフォルトを配布したい場合は、このファイルをバイナリと一緒に配布すると運用が楽になります。

## FAQ / エラーコード一覧
GUI やエクスポートに表示されるエラーはすべて共通コードを使用します。状況に応じて以下の対応を実施してください。

| コード | 概要 | 推奨対応 |
| --- | --- | --- |
| **RF001** | スキャンが完了前に中断されました。 | 再度 **開始** を押してスキャンを再実行してください。ユーザーが **停止** を押した場合もこのコードになります。 |
| **RF002** | PATH 上に Nmap 実行ファイルがありません。 | OS に合わせて Nmap をインストールし、新しいシェルで `nmap --version` が通るか確認後 Rogue Finder を再起動してください。 |
| **RF003** | Nmap がタイムアウトしました (既定 300 秒)。 | 対象ホストを減らす／分割する、もしくは `rogue-finder.config.yaml` の `scan.default_timeout_seconds` を増やして再配布してください。 |
| **RF004** | Nmap 実行時にエラーが返されました (詳細メッセージ付き)。 | 権限・FW・入力ミスなどを確認し、必要なら管理者権限で再実行してください。 |
| **RF005** | ワーカープロセスが異常終了しました。 | 同時ターゲット数を減らして再試行するか、アプリを再起動してプールを再構築してください。 |
| **RF006** | スキャン処理で予期せぬ例外が発生しました。 | 表示された詳細とログを確認し、再現する場合はチームに報告してください。 |

## その他の注意事項
- **SmartScreen 警告 (Windows):** 自己署名/未署名バイナリは初回実行時に SmartScreen の「Windows によって PC が保護されました」と表示されることがあります。信頼できる入手元 (自組織のビルドや公式リリース) であることを確認し、「詳細情報」→「実行」から起動してください。全社配布する場合はコード署名証明書の導入を推奨します。
- **Gatekeeper の隔離属性 (macOS):** ブラウザからダウンロードした `rogue-finder` には `com.apple.quarantine` 属性が付与され、削除しないと「開発元を確認できないため開けません」と表示されます。Finder で右クリック → **開く** を 2 回繰り返すか、ターミナルで保存先ディレクトリに移動して `xattr -dr com.apple.quarantine ./rogue-finder` を実行してから起動してください。
- **ウイルス対策との競合:** 一部のセキュリティ製品は `nmap.exe` の通信を制限します。断続的なタイムアウトが続く場合、検証用端末や例外設定の適用をご検討ください。
- **結果データの取り扱い:** CSV/JSON には内部ホスト名や開放ポートなどの機密情報が含まれるため、社内ポリシーに沿って安全に保管してください。

## サポート窓口
本マニュアルで解決しない問題が発生した場合は、エラーコードと再現手順・スクリーンショットを添えて社内のセキュリティチーム、または GitHub Issue (公式リリースの場合) に報告してください。
