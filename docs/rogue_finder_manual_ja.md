# Rogue Finder ユーザーマニュアル (日本語)

## 目的と読者
Rogue Finder はローカルにインストールされた Nmap を呼び出して軽量なディスカバリースキャンを実行し、透明性の高いスコアリングモデルで優先度を算出するクロスプラットフォーム デスクトップアプリです。本書は PyInstaller 版を利用するオペレーター向けに、導入方法・日常運用・トラブルシューティングをまとめています。

## 機能サマリ
- ローカルの `nmap` バイナリを使って ICMP ping (`-sn -PE`)、TCP SYN ポート (`-sS`)、OS フィンガープリント (`-O -Pn`) を順番に実行。
- IP / CIDR / ホスト名を複数登録し、GUI を固まらせることなく並列スキャンを実施。
- README の **Rating Model Overview**（`rating.py` 実装）に従って各ホストを High / Medium / Low に色分けし、スコア内訳とエラーを一覧表示。
- CSV / JSON エクスポートでスコア内訳やエラー文字列を UTF-8 で保存し、証跡共有を容易にします。

## 必要条件とインストール手順
1. PyInstaller バイナリ単体で実行できますが、Nmap は別途インストールし `PATH` 上で検出できる必要があります。
2. OS ごとに Nmap を導入し、`nmap --version` が成功することを確認してください。
   - **Windows:** <https://nmap.org/download.html> から公式インストーラーを取得し、デフォルト設定で導入後に新しいコマンドプロンプトで `nmap --version` を実行。
   - **macOS (arm64 ビルド):** リリースは Apple Silicon (macOS 15+) で検証済みです。Intel Mac はソースから (`python -m nmap_gui.main`) 実行するか Rosetta を利用してください。`brew install nmap` もしくは公式 dmg で Nmap を導入します。
   - **Linux:** パッケージマネージャーからインストール（例: `sudo apt install nmap`）。
3. Rogue Finder の実行ファイルと本マニュアルを同じディレクトリに配置すると参照しやすくなります。

## アプリの使い方
1. **GUI を起動** — `rogue-finder.exe`（Windows）または `./rogue-finder` を実行します。
2. **ターゲットを入力** — カンマ / 改行 / タブ / セミコロン区切りで複数ターゲットを貼り付けます。例: `198.51.100.0/24`, `server01.local`, `203.0.113.10`。
3. **スキャンモードを選択** — ICMP / Ports / OS の各チェックボックスで不要フェーズを無効化できます。既定ではすべて有効です。
4. **スキャン開始** — **Start** を押すとステータスバーに “Scanning…” が表示され、進捗バーが完了ターゲットを示します。**Stop** でいつでもキャンセル可能です。
5. **結果を確認** — 各行に Alive 状態、ポート、OS 推定、スコア、優先度、エラー/アクション案が表示されます。スコアや優先度で並び替えて重要ホストを素早く抽出できます。
6. **証跡をエクスポート** — **Export CSV** / **Export JSON** で UTF-8 ファイルを出力します。構造化された `errors` とローカライズ済みの `errors_text` の両方が含まれます。

### ベストプラクティス
- 1 回のターゲット数は /24 程度か数十ホストに抑え、極端に長いスキャンや配布ファイルの警告を避けてください。
- エクスポートを行う場合は書き込み権限のあるディレクトリで実行します。
- 本番ネットワークを扱う際は必ず事前承認を得て、Rogue Finder 既定以上の侵襲的オプションは使用しないでください。

## 設定ファイル
起動時に現在のディレクトリで `rogue-finder.config.yaml` を探し、無ければ安全な既定値で生成します。バージョンアップ時は不足キーのみ自動追加され、既存の上書きは保持されます。この YAML で `scan`（タイムアウトやポートリスト）、`rating`（加点ルールや優先度境界）、`safe_scan`（セーフスクリプト診断の ETA 推定）、`ui`（行カラー）を調整できます。PyInstaller 配布物に組織固有のデフォルトを同梱したい場合は、このファイルを一緒に配布してください。

## FAQ & エラーコード
Rogue Finder は GUI / ダイアログ / エクスポートで共通のエラーコードを表示します。状況に応じて以下を実施してください。

| コード | メッセージ概要 | 推奨対応 |
| --- | --- | --- |
| **RF001** | スキャンが完了前に中断されました。 | 再度 **Start** を押して再実行してください。**Stop** を押した場合もこのコードになります。 |
| **RF002** | PATH 上に Nmap が見つかりません。 | OS に合わせて Nmap をインストールし、新しいシェルで `nmap --version` を確認後 Rogue Finder を再起動します。 |
| **RF003** | Nmap がタイムアウトしました (既定 300 秒)。 | ターゲット数/範囲を減らすか `scan.default_timeout_seconds` を増加させて再ビルド/配布します。 |
| **RF004** | Nmap 実行時にエラーが発生しました。 | 権限・ファイアウォール・入力内容を確認し、必要に応じて管理者権限で再実行してください。 |
| **RF005** | ワーカープロセスが予期せず終了しました。 | 同時ターゲット数を減らすかアプリを再起動してプールを再構築してください。 |
| **RF006** | スキャン処理で未処理例外が発生しました。 | 表示された詳細とログを確認し、再現する場合はチームまたは GitHub Issue に報告してください。 |

## 追加メモ
- **SmartScreen の警告 (Windows):** 署名されていない実行ファイルは「Windows によって PC が保護されました」と表示されることがあります。信頼できる配布元（自社ビルドか公式リリース）を確認し、「詳細情報」→「実行」で進めてください。大規模配布時はコード署名証明書の活用を検討してください。
- **Gatekeeper の隔離属性 (macOS):** ダウンロードしたファイルには `com.apple.quarantine` が付くため、「開発元を確認できないため開けません」と表示される場合があります。保存先ディレクトリで `xattr -dr com.apple.quarantine ./rogue-finder` を実行するか、Finder で右クリック → **開く** を 2 回行って承認してください。
- **ウイルス対策ソフトとの干渉:** 一部製品は `nmap.exe` や Rogue Finder のサブプロセスをスロットルします。タイムアウトが続く場合は一時的な例外設定や許可済みワークステーションの利用を検討してください。
- **データ取り扱い:** エクスポートファイルにはホスト名やサービス情報が含まれるため、社内ポリシーに沿った保管・共有を徹底してください。

## サポート
FAQ を試しても解決しない場合は GUI のスクリーンショットまたはエクスポート、エラーコード、再現手順を添えて社内セキュリティチームに連絡するか、公式リリースを利用している場合は GitHub Issue を作成してください。
